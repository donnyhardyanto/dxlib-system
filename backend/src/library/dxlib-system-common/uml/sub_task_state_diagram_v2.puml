@startuml
!theme blueprint
'https://plantuml.com/state-diagram

left to right direction
title SubTask State Diagram

'scale 1000 width
'scale 2000 height
skinparam nodesep 30
skinparam ranksep 10

state start1 <<start>>
'state join_state1 <<join>>
state join_state2 <<join>>
'state join_expired1 <<join>>
state join_cancel_by_field_executor1 <<join>>
'state join_waiting_assignment1 <<join>>
state end1 <<end>>

state TASK__WAITING_ASSIGNMENT {
  'state B <<entryPoint>>
  start1 --> WAITING_ASSIGNMENT
  start1 --> BLOCKING_DEPENDENCY
}



state TASK__CANCELED_BY_CUSTOMER
    CANCELED_BY_CUSTOMER --> end1
}

state TASK__COMPLETED {
    CGP_VERIFICATION_SUCCESS --> end2

}

state TASK__IN_PROGRESS {
    join_state2 --> CANCELED_BY_CUSTOMER
    'join_state1 --> CANCELED_BY_CUSTOMER
    'join_expired1 --> EXPIRED
    join_cancel_by_field_executor1 --> CANCELED_BY_FIELD_EXECUTORÃŸ
    'join_waiting_assignment1 -> WAITING_ASSIGNMENT

    BLOCKING_DEPENDENCY --> WAITING_ASSIGNMENT : [Trigger] UnblockDependency
    BLOCKING_DEPENDENCY --> join_state2 : [FieldExecutor] CancelByCustomer
    BLOCKING_DEPENDENCY --> EXPIRED
    BLOCKING_DEPENDENCY -> end1 : [Admin] Remove

    WAITING_ASSIGNMENT -> ASSIGNED : [FieldExecutor] Pick/Assigned
    WAITING_ASSIGNMENT -> end1b : [Admin] Remove
    WAITING_ASSIGNMENT --> join_state2 : [FieldExecutor] CancelByCustomer
    WAITING_ASSIGNMENT --> EXPIRED : [Auto] Expired

    ASSIGNED -> WORKING : [FieldExecutor] StartWorking
    ASSIGNED --> join_cancel_by_field_executor1 : [FieldExecutor|Admin] CancelByFieldExecutor
    ASSIGNED --> join_state2 : [FieldExecutor] CancelByCustomer
    ASSIGNED -> EXPIRED : [Auto] Expired

    WORKING --> PAUSED : [FieldExecutor] Pause
    WORKING --> join_cancel_by_field_executor1 : [FieldExecutor] CancelByFieldExecutor
    WORKING -> WAITING_VERIFICATION : [FieldExecutor] DoneWorking
    WORKING ---> join_state2 : [FieldExecutor] CancelByCustomer

    PAUSED -> WORKING : [FieldExecutor] ResumeWorking
    PAUSED --> join_cancel_by_field_executor1 : [FieldExecutor] CancelByFieldExecutor
    PAUSED --> CANCELED_BY_CUSTOMER : [FieldExecutor] CancelByCustomer

    WAITING_VERIFICATION --> REWORKING : [FieldExecutor] StartReworking
    WAITING_VERIFICATION --> VERIFICATION_FAILED : [FieldSupervisor] VerifyFailed
    WAITING_VERIFICATION -> VERIFICATION_SUCCESS: [FieldSupervisor] VerifySuccess

    REWORKING -> WAITING_VERIFICATION : [FieldExecutor] DoneReworking ]

    REWORKING --> CANCELED_BY_CUSTOMER : [FieldExecutor] CancelByCustomer
    REWORKING -> WAITING_VERIFICATION : [FieldExecutor] CancelReworking


    VERIFICATION_FAILED --> FIXING : [FieldExecutor] StartFixing


    VERIFICATION_SUCCESS --> CGP_VERIFICATION_FAILED : [AdminCGP] VerifyFailed
    VERIFICATION_SUCCESS -> CGP_VERIFICATION_SUCCESS : [AdminCGP] VerifySuccess
    WAITING_VERIFICATION -> CGP_VERIFICATION_FAILED : [AdminCGP] VerifyFailed
    WAITING_VERIFICATION -> CGP_VERIFICATION_SUCCESS : [AdminCGP] VerifySuccess

    end2 --> CGP_VERIFICATION_SUCCESS : [AdminCGP] EditAfterSuccess
    CGP_VERIFICATION_FAILED -> FIXING: [FieldExecutor] StartFixing

    FIXING -> WAITING_VERIFICATION :  [FieldExecutor] DoneFixing
    FIXING --> CANCELED_BY_CUSTOMER : [FieldExecutor] CancelByCustomer

    EXPIRED -> WAITING_ASSIGNMENT : [Admin] ChangeExpiredToWaitingAssignment
    CANCELED_BY_FIELD_EXECUTOR -> WAITING_ASSIGNMENT : (Auto)

}




@enduml